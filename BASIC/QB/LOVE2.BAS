DEFINT A-Z
TYPE REGSTYPE
  AX AS INTEGER
  BX AS INTEGER
  CX AS INTEGER
  DX AS INTEGER
  BP AS INTEGER
  SI AS INTEGER
  DI AS INTEGER
  DS AS INTEGER
  ES AS INTEGER
  FLAGS AS INTEGER
END TYPE
DECLARE SUB INTX (N AS INTEGER, REGS AS REGSTYPE)
DECLARE FUNCTION n$ (n%)
DECLARE SUB TX (s AS STRING)

DIM SHARED ASMINTX(37)
COMMON SHARED REGS AS REGSTYPE

DATA &H56,&HBE,&H0,&H0,&H50,&HB8,&H0,&H0,&H53,&H51,&H52,&H55,&H57,&H1E,&H6
DATA &H8E,&HD8,&HB9,&H9,&H0,&HFF,&H34,&H46,&H46,&HE2,&HFA,&H7,&H1F,&H5F,&H5E
DATA &H5D,&H5A,&H59,&H5B,&H58,&HCD,&H0,&H9C,&H6,&H1E,&H57,&H56,&H55,&H52,&H51
DATA &H53,&H50,&HB8,&H0,&H0,&H8E,&HD8,&HB9,&HA,&H0,&HBE,&H0,&H0,&H8F,&H4,&H46
DATA &H46,&HE2,&HFA,&H7,&H1F,&H5F,&H5D,&H5A,&H59,&H5B,&H58,&H5E,&HCB

DEF SEG=VARSEG(ASMINTX(0)): P=VARPTR(ASMINTX(0))
FOR I=0 TO 73: READ V: POKE P+I,V: NEXT I
DEF SEG

REGS.AX=&HDB00:CALL INTX(&H2F,REGS)
IF (REGS.AX AND 255)<>255 OR REGS.BX<>&H5450 THEN
  PRINT "Please run UCDOS first.":END
END IF
REGS.AX=&HFF00:REGS.BX=&HA03:CALL INTX(&H10,REGS)
IF (REGS.AX AND 255)=255 THEN
  PRINT "256 color mode required.": END
END IF
REGS.AX=&H11:CALL INTX(&H79,REGS)
IF (REGS.FLAGS AND &H40)=0 THEN
  PRINT "Please run TX.COM first.": END
END IF

PI#=3.141592654#

OPEN "LPT3" FOR OUTPUT AS #1
FONTSIZE=100:HEARTX=320:HEARTY=10:HEARTW=50:HEARTH=150
TX ("M10CU1,0KB1,0CL0CO7B0,0,640,480RE0,0,LOVE2.PCX${%1=13@"+n$(FONTSIZE)+","+n$(FONTSIZE)+"}")
FOR DY=-1 TO 1: FOR DX=-1 TO 1
    IF DX<>0 OR DY<>0 THEN
        TX ("{(3|"+n$(DY+40)+"-"+n$(DX+1)+"石头-"+n$(DX+638-FONTSIZE*2)+"春婷}")
    END IF
NEXT DX: NEXT DY
TX ("{(11|40-1石头-"+n$(638-FONTSIZE*2)+"春婷}")
X$=n$(HEARTX-HEARTW): Y$=n$(HEARTY+HEARTW): R$=n$(HEARTW)
TX("CO13E"+X$+","+Y$+",0,180,"+R$+","+R$+",2")
TX("CO5E"+X$+","+Y$+",0,180,"+R$+","+R$+",0")
X$=n$(HEARTX+HEARTW)
TX("CO13E"+X$+","+Y$+",0,180,"+R$+","+R$+",2")
TX("CO5E"+X$+","+Y$+",0,180,"+R$+","+R$+",0")
FOR Y0=1 TO HEARTH
   X=INT(HEARTW*2*COS(PI#*Y0/2/HEARTH)+.5)
   X$=n$(HEARTX-X): X2$=n$(HEARTX+X)
   Y$=n$(HEARTY+HEARTW+Y0)
   TX("CO13L"+X$+","+Y$+","+X2$+","+Y$)
   TX("CO5D"+X$+","+Y$+"D"+X2$+","+Y$)
NEXT Y0

WHILE INPUT$(1) = "": WEND
TX ("KB1,1M3CU1,1")
CLOSE
END

FUNCTION n$ (A AS INTEGER)
n$ = LTRIM$(RTRIM$(STR$(A)))
END FUNCTION

SUB TX (s AS STRING)
PRINT #1, CHR$(14); "["; s; "]";
END SUB

SUB INTX (N AS INTEGER, REGS AS REGSTYPE)
  STATIC DS AS INTEGER,SI AS INTEGER,P AS INTEGER
  DS=VARSEG(REGS):SI=VARPTR(REGS)
  ASMINTX(1)=SI:ASMINTX(3)=DS
  ASMINTX(24)=DS:ASMINTX(28)=SI
  DEF SEG=VARSEG(ASMINTX(0)):P=VARPTR(ASMINTX(0))
  POKE P+&H24,N:CALL ABSOLUTE(P):DEF SEG
END SUB

