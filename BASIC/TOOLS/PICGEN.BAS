DEFINT A-Z
TYPE FontDataT
  CH0 AS STRING * 1
  CH1 AS STRING * 1
  FONT AS INTEGER
  W AS INTEGER
  H AS INTEGER
  TOP AS INTEGER
  BOTTOM AS INTEGER
  ATTR AS INTEGER
  BUFLEN AS INTEGER
END TYPE
TYPE BMPHeaderT
    id AS STRING * 2
    size AS LONG
    rr1 AS INTEGER
    rr2 AS INTEGER
    offset AS LONG
    horz AS LONG
    wid AS LONG
    hei AS LONG
    planes AS INTEGER
    bpp AS INTEGER
    pakbyte AS LONG
    imagebytes AS LONG
    xres AS LONG
    yres AS LONG
    colch AS LONG
    ic AS LONG
END TYPE

DIM SHARED ASM(40),BITMASK(8),SCALEMAP(256)
DIM SHARED BG(4098) AS INTEGER,BITMAP(8194) AS INTEGER

REM Initialize data needed
FOR I=0 TO 7: BITMASK(I)=2^(7-I): NEXT I

REM Initialize map for scaling image
DATA 0,3,12,15,48,51,60,63,192,195,204,207,240,243,252,255
FOR I=0 TO 15:READ BG(I):NEXT I
FOR I=0 TO 15:FOR J=0 TO 7
  N=BG(I) OR BG(J)*256:OF=I*16+J
  SCALEMAP(OF)=N:SCALEMAP(OF+8)=N OR &HC000
NEXT J:NEXT I

REM DEBUG <PICGEN.TXT >DATA.TXT
DATA &H55,&H89,&HE5,&H8B,&H76,&H06,&HC7,&H04,&H00,&H00,&HB8,&H00
DATA &HDB,&HCD,&H2F,&H3C,&HFF,&H75,&H11,&H81,&HFB,&H50,&H54,&H75
DATA &H0B,&HB8,&H01,&H00,&HCD,&H79,&H75,&H04,&HC7,&H04,&H01,&H00
DATA &H89,&HEC,&H5D,&HCA,&H02,&H00,&HB8,&H0B,&HFF,&HCD,&H16,&HCB
DATA &H55,&H89,&HE5,&H1E,&H06,&HC4,&H7E,&H06,&HC5,&H76,&H0A,&HCD
DATA &H7E,&H07,&H1F,&H89,&HEC,&H5D,&HCA,&H08,&H00

REM Load asm then Check if UCDOS and RDFNT is running
DEF SEG=VARSEG(ASM(0)):P=VARPTR(ASM(0))
FOR I=0 TO 68:READ D:POKE P+I,D:NEXT I
ENVOK=0:CALL ABSOLUTE(ENVOK,P)
IF ENVOK=0 THEN PRINT "Please run UCDOS and RDFNT first.":END
DEF SEG

REM MOONRIVR.BAS
LOCATE 1,1,0:SCREEN 1:CLS
'DEF SEG=VARSEG(BG(0)):BLOAD "BG.PIC",VARPTR(BG(0)):DEF SEG
CALL LoadBMP(BG(),"MOONRIVR.BMP")
CALL ScaleImage(BITMAP(),BG()):PUT (0,0),BITMAP
CALL DrawStr("Moon River",7,20,2,56,70,0,1)
CALL DrawStr("Audrey Hepburn",49,148,10,32,32,0,2)
DEF SEG = &HB800: BSAVE "MOONRIVR.PIC", 0, 16384: DEF SEG
CALL Pause(200.0)

REM ZSJS.BAS GUSHI.BAS
LOCATE 1,1,0:SCREEN 2:CALL PreDraw:CLS
W=156:H=76
CALL DrawStr("÷Ó ¬",0,0,3,W,H,0,1)
CALL DrawStr("Ω‘À≥",0,76,3,W,H,0,1)
CALL DrawStr("∑„",320,0,3,24,24,0,1)
CALL DrawStr("«≈",320,24,3,24,24,0,1)
CALL DrawStr("“π",320,48,3,24,24,0,1)
CALL DrawStr("≤¥",320,72,3,24,24,0,1)
CALL DrawStr("’≈",344,0,0,12,12,0,1)
CALL DrawStr("ºÃ",344,12,0,12,12,0,1)
CALL DrawStr(" Ø",356,0,0,48,48,0,1)
CALL DrawStr("Õ∑",356,48,0,48,48,0,1)
CALL DrawStr("¥∫",356,96,0,48,48,0,1)
CALL DrawStr("Ê√",356,144,0,48,48,0,1)

GET (0,0)-(W*2-1,H*2-1),BITMAP(0)
DEF SEG=VARSEG(BITMAP(0))
BSAVE "ZSJS.PIC",VARPTR(BITMAP(0)),((W*2+7)\8)*(H*2)+4
DEF SEG

GET (356,0)-(356+47,48*4-1),BITMAP(0)
DEF SEG=VARSEG(BITMAP(0)): BSAVE "LOVE.BIN",VARPTR(BITMAP(0))+4,48*6*4:DEF SEG

CALL LoadBMP(BG(),"GUSHI.BMP")
OFFSET=(((BG(0)+7)\8)*BG(1)+5)\2

GET (320,0)-(343,24*4-1),BITMAP(0)
ARRLEN=(BITMAP(0)\8)*BITMAP(1)\2
FOR I=0 TO ARRLEN-1:BG(OFFSET)=BITMAP(I+2):OFFSET=OFFSET+1:NEXT I

GET (344,0)-(355,23),BITMAP(0)
ARRLEN=((BITMAP(0)+7)\8)*BITMAP(1)\2
FOR I=0 TO ARRLEN-1:BG(OFFSET)=BITMAP(I+2):OFFSET=OFFSET+1:NEXT I

FOR I=0 TO 479:READ A,B
  BG(OFFSET)=CVI(CHR$(A)+CHR$(B)):OFFSET=OFFSET+1
NEXT I
DEF SEG=VARSEG(BG(0)): BSAVE "GUSHI.BIN",VARPTR(BG(0)),OFFSET*2: DEF SEG

CALL Pause(200.0)

SCREEN 0: WIDTH 80: LOCATE ,,1: CLS : END

SUB LoadBMP(D() AS INTEGER,PATH AS STRING)
  STATIC hdr AS BMPHeaderT, LBUF AS STRING*160
  STATIC Y,I,W,H,P,rowBytesBmp,rowBytes
  OPEN PATH FOR BINARY AS #1:GET #1,1,hdr
  IF "BM"<>hdr.id THEN PRINT "Invalid BMP File.": EXIT SUB
  IF 1<>hdr.bpp THEN PRINT "BMP file must be of 1bit.":EXIT SUB
  W=hdr.wid: H=hdr.hei: rowBytesBmp=((W+31)\32)*4: rowBytes=(W+7)\8
  D(0)=W:D(1)=H:DEF SEG=VARSEG(D(0)):P=VARPTR(D(0))+4
  FOR Y=0 TO H-1
    GET #1,1+hdr.offset+(H-1-Y)*rowBytesBmp,LBUF
    FOR I=0 TO rowBytes-1
      POKE P,ASC(MID$(LBUF,I+1,1)): P=P+1
    NEXT I
  NEXT Y
  CLOSE #1
END SUB

SUB PreDraw()
  DEF SEG=VARSEG(ASM(0)):CALL ABSOLUTE(VARPTR(ASM(0))+&H2A):DEF SEG
END SUB

SUB ScaleImage(DST() AS INTEGER,SRC() AS INTEGER)
  STATIC SRCL,I,P
  SRCL=(SRC(0)+7)\8
  DST(0)=SRCL*16
  DST(1)=SRC(1)
  DEF SEG=VARSEG(SRC(0)):P=VARPTR(SRC(2))
  FOR I=0 TO SRCL*SRC(1)-1
    DST(I+2)=SCALEMAP(PEEK(P+I))
  NEXT I
END SUB

SUB DrawStr(STR AS STRING, X1 AS INTEGER, Y1 AS INTEGER, FONT AS INTEGER, W0 AS INTEGER, H AS INTEGER, SP0 AS INTEGER, C AS INTEGER)
  STATIC I,L,WA,XA,CH$
  I=0: L=LEN(STR): WA=W0: XA=X1
  WHILE I<L
    CH$=MID$(STR,I+1,1)
    IF ASC(CH$)>=&H80 THEN
      I=I+1: CH$=CH$+MID$(STR,I+1,1)
    END IF
    WA=W0: CALL DrawChar(CH$,XA,Y1,FONT,WA,H,C)
    XA=XA+WA+SP0: I=I+1
  WEND
END SUB

SUB DrawChar(STR AS STRING, X0 AS INTEGER, Y0 AS INTEGER, FONT AS INTEGER, W AS INTEGER, H AS INTEGER, C AS INTEGER)
  STATIC Param AS FontDataT
  IF ASC(MID$(STR,1,1)) < &H80 THEN
    Param.CH0=STR: Param.CH1=CHR$(0)
    Param.W=W\2
  ELSE
    Param.CH0=MID$(STR,2,1): Param.CH1=MID$(STR,1,1)
    Param.W=W
  END IF
  Param.FONT=FONT: Param.H=H
  Param.TOP=0: Param.BOTTOM=H-1
  Param.ATTR=1: Param.BUFLEN=16384
  DS=VARSEG(Param):SI=VARPTR(Param)
  ES=VARSEG(BITMAP(0)):DI=VARPTR(BITMAP(0))
  DEF SEG=VARSEG(ASM(0))
  CALL ABSOLUTE(BYVAL DS,BYVAL SI,BYVAL ES,BYVAL DI,VARPTR(ASM(0))+&H30)
  DEF SEG
  W=Param.W
  DEF SEG=VARSEG(BITMAP(0)): ROWBYTES=(W+7)\8: PX=VARPTR(BITMAP(0)): P=PEEK(PX)
  FOR Y=0 TO (H-1): FOR X=0 TO (W-1)
    IF P AND BITMASK(X AND 7) THEN PSET (X0+X,Y0+Y),C
    IF (X AND 7)=7 OR X=(W-1) THEN PX=PX+1: P=PEEK(PX)
  NEXT X: NEXT Y: DEF SEG
END SUB

SUB Pause(INTERVAL AS DOUBLE)
  T#=TIMER:T0#=T#
  WHILE INKEY$="" AND T#-T0#<INTERVAL
    T#=TIMER
  WEND
END SUB

DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,0,0,48,0,48,0,16,0,32,0,0,0
DATA 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DATA 0,0,0,0,48,0,72,0,72,0,48,0,0,0,0,0
DATA 0,16,15,248,8,16,8,16,8,16,15,240,8,16,8,16
DATA 8,16,15,240,8,16,8,16,16,16,16,16,32,80,64,32
DATA 8,32,8,36,255,254,9,32,65,248,35,16,36,160,128,64
DATA 73,176,18,14,47,244,226,16,34,16,34,16,35,240,34,16
DATA 2,0,4,32,31,240,16,32,16,32,16,32,16,160,16,64
DATA 16,4,31,254,0,4,0,36,255,244,0,4,0,40,0,16
DATA 0,64,0,32,121,252,72,136,72,80,75,254,74,34,76,32
DATA 73,252,121,36,73,36,1,36,1,36,1,44,0,32,0,32
DATA 31,240,1,0,127,254,65,2,157,116,1,0,29,112,8,4
DATA 8,254,126,132,8,252,28,132,42,252,72,132,8,252,8,132
DATA 65,32,49,36,31,254,1,32,128,0,111,252,33,32,1,32
DATA 31,252,41,36,233,36,42,212,44,12,40,4,40,20,40,8
DATA 0,8,127,252,1,0,1,0,1,0,1,4,255,254,1,0
DATA 2,128,2,128,4,64,4,64,8,32,16,16,32,14,192,4
DATA 64,0,48,8,23,252,0,64,128,64,96,64,40,64,8,64
DATA 16,64,16,64,96,64,32,64,32,68,47,254,32,0,32,0
DATA 16,0,16,8,19,252,18,8,254,8,18,24,51,24,58,168
DATA 86,72,82,72,146,168,19,24,18,24,20,10,20,10,24,6
DATA 1,0,65,8,49,252,18,16,132,32,111,252,36,68,12,68
DATA 23,252,36,68,228,68,39,252,36,4,32,0,47,254,32,0
DATA 1,0,1,0,1,0,1,0,17,8,17,24,17,32,33,64
DATA 66,128,2,128,4,64,4,64,8,32,16,16,32,14,64,4
DATA 0,16,0,16,0,16,252,16,5,254,4,16,72,16,41,16
DATA 16,144,16,144,40,16,36,16,68,16,128,16,0,80,0,32
DATA 4,32,14,32,120,32,8,164,254,172,8,176,29,80,42,72
DATA 72,142,9,4,2,0,9,0,40,136,40,164,72,36,7,224
DATA 0,8,123,252,74,8,74,8,74,8,123,248,74,64,74,68
DATA 75,254,122,64,74,32,74,32,74,16,122,146,75,10,2,6
DATA 16,32,16,32,16,32,16,36,19,254,252,32,36,32,36,36
DATA 69,254,37,4,25,4,17,4,41,4,69,4,129,252,1,4
DATA 4,64,4,68,255,254,4,0,2,0,2,32,63,240,2,32
DATA 34,40,34,36,36,36,68,36,8,32,16,32,33,64,64,128
DATA 32,32,32,40,32,36,39,254,252,32,36,32,36,36,39,164
DATA 36,168,36,168,60,144,230,144,69,48,8,82,8,138,16,6
DATA 8,64,8,64,8,64,16,64,31,64,33,96,33,80,98,72
DATA 146,70,10,66,4,64,8,64,16,64,32,64,64,64,0,64
DATA 2,0,1,0,127,254,68,66,159,244,4,64,31,240,4,64
DATA 127,252,4,64,11,32,16,144,32,78,198,4,1,128,0,64
DATA 1,0,1,0,1,0,1,0,65,4,65,4,65,4,65,4
DATA 65,4,65,4,65,4,65,4,65,4,127,252,64,4,0,0
DATA 1,0,1,8,127,252,1,0,1,0,1,4,255,254,0,32
DATA 0,32,127,252,8,32,4,32,4,32,0,32,0,160,0,64
DATA 2,0,1,4,255,254,8,128,8,128,16,248,17,8,50,136
DATA 86,80,153,16,16,160,16,64,16,160,17,16,18,14,28,4
DATA 1,0,33,8,25,24,9,32,1,0,63,248,1,0,1,0
DATA 1,4,255,254,1,0,1,0,1,0,1,0,1,0,1,0
DATA 16,32,16,32,16,32,28,36,33,254,33,36,125,36,145,36
DATA 17,36,253,252,17,36,16,32,20,32,24,32,16,32,0,32
DATA 1,0,1,4,255,254,1,0,127,252,0,0,63,248,33,8
DATA 33,8,63,248,32,8,32,0,32,0,64,0,64,0,128,0
DATA 1,4,127,132,8,4,16,36,34,36,65,36,127,164,8,164
DATA 8,36,8,36,127,36,8,36,8,4,15,132,248,20,64,8
DATA 2,0,1,0,127,254,72,2,143,244,8,32,20,64,35,128
DATA 12,96,48,30,207,228,8,32,8,32,8,32,15,224,8,32
DATA 8,8,16,124,62,72,34,72,50,72,42,72,34,134,35,0
DATA 254,4,34,254,50,132,42,132,34,132,66,132,138,252,4,132

