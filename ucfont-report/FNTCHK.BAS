DEFINT A-Z
TYPE FontDataT
  CH0 AS STRING * 1
  CH1 AS STRING * 1
  FONT AS INTEGER
  W AS INTEGER
  H AS INTEGER
  TOP AS INTEGER
  BOTTOM AS INTEGER
  ATTR AS INTEGER
  BUFLEN AS INTEGER
END TYPE

DIM SHARED ASM(40) AS INTEGER,BITMAP(256) AS INTEGER

REM DEBUG <FNTCHK.TXT >DATA.TXT
DATA &H55,&H89,&HE5,&H8B,&H76,&H06,&HC7,&H04,&H00,&H00,&HB8,&H00
DATA &HDB,&HCD,&H2F,&H3C,&HFF,&H75,&H11,&H81,&HFB,&H50,&H54,&H75
DATA &H0B,&HB8,&H01,&H00,&HCD,&H79,&H75,&H04,&HC7,&H04,&H01,&H00
DATA &H89,&HEC,&H5D,&HCA,&H02,&H00,&HB8,&H0B,&HFF,&HCD,&H16,&HCB
DATA &H55,&H89,&HE5,&H1E,&H06,&HC4,&H7E,&H06,&HC5,&H76,&H0A,&HCD
DATA &H7E,&H07,&H1F,&H89,&HEC,&H5D,&HCA,&H08,&H00

REM Load asm then Check if UCDOS and RDFNT is running
DEF SEG=VARSEG(ASM(0)):P=VARPTR(ASM(0))
FOR I=0 TO 68:READ D:POKE P+I,D:NEXT I
ENVOK=0:CALL ABSOLUTE(ENVOK,P)
IF ENVOK=0 THEN PRINT "Please run UCDOS and RDFNT first.":END
DEF SEG

KILL "FNTCHK.LOG"

FOR FONT=0 TO 8
  CALL CheckFNT(FONT)
NEXT FONT
REM Font 9 may crash the system when rendering char after ECB3
FOR FONT=10 TO 14
  CALL CheckFNT(FONT)
NEXT FONT
FOR FONT=20 TO 33
  CALL CheckFNT(FONT)
NEXT FONT
PRINT""
END

SUB PreDraw()
  DEF SEG=VARSEG(ASM(0)):CALL ABSOLUTE(VARPTR(ASM(0))+&H2A):DEF SEG
END SUB

SUB CheckHZ(QU AS INTEGER,WEI AS INTEGER,FONT AS INTEGER,RES AS INTEGER)
  STATIC Param AS FontDataT
  Param.CH0=CHR$(WEI): Param.CH1=CHR$(QU)
  Param.W=32
  Param.FONT=FONT: Param.H=32
  Param.TOP=0: Param.BOTTOM=Param.H-1
  Param.ATTR=1: Param.BUFLEN=512
  DS=VARSEG(Param):SI=VARPTR(Param)
  ES=VARSEG(BITMAP(0)):DI=VARPTR(BITMAP(0))
  DEF SEG=VARSEG(ASM(0))
  CALL ABSOLUTE(BYVAL DS,BYVAL SI,BYVAL ES,BYVAL DI,VARPTR(ASM(0))+&H30)
  DEF SEG
  RES=0:FOR I=0 TO 64:IF BITMAP(I)<>0 THEN RES=1:EXIT SUB
  NEXT I
END SUB

SUB CheckFNT(FONT AS INTEGER)
  STATIC RES,FAIL AS STRING,FILENUM AS INTEGER
  FILENUM=FREEFILE
  FAIL=""
  FOR QU=&HB0 TO &HF7:FOR WEI=&HA1 TO &HFE
    IF NOT (QU=&HD7 AND WEI>=&HFA) THEN
      LOCATE ,1:PRINT FONT;HEX$(QU);HEX$(WEI);TAB(40);
      RES=0:CALL CheckHZ(QU,WEI,FONT,RES)
      IF RES=0 THEN FAIL=FAIL+CHR$(QU)+CHR$(WEI)
    END IF
  NEXT WEI:NEXT QU
  IF FAIL<>"" THEN
    OPEN "FNTCHK.LOG" FOR APPEND AS FILENUM
    PRINT #FILENUM,FONT;FAIL
    CLOSE #FILENUM
  END IF
END SUB

